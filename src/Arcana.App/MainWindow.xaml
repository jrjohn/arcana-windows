<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Arcana.App.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Arcana.App"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    Title="Arcana">

    <Grid x:Name="RootGrid" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.Resources>
            <!-- Default theme brushes (will be overridden by ThemeService) -->
            <SolidColorBrush x:Key="ThemeAccentBrush" Color="#0078D4"/>
            <SolidColorBrush x:Key="ThemeBackgroundBrush" Color="#F9F9F9"/>
            <SolidColorBrush x:Key="ThemePaneBackgroundBrush" Color="#F3F3F3"/>
            <SolidColorBrush x:Key="ThemeTextPrimaryBrush" Color="#000000"/>
            <SolidColorBrush x:Key="ThemeTextSecondaryBrush" Color="#606060"/>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar with Menu -->
        <Grid x:Name="AppTitleBar" Height="32" Background="{ThemeResource NavigationViewDefaultPaneBackground}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- App Icon and Name -->
            <StackPanel Orientation="Horizontal" Spacing="8" Margin="12,0">
                <Image Source="Assets/app-icon.png" Width="16" Height="16" VerticalAlignment="Center"/>
                <TextBlock Text="Arcana" Style="{StaticResource CaptionTextBlockStyle}" VerticalAlignment="Center" FontWeight="SemiBold"/>
            </StackPanel>

            <!-- Dynamic Plugin Menu Bar -->
            <MenuBar x:Name="MainMenuBar" Grid.Column="1" VerticalAlignment="Center">
                <!-- Menu items are populated dynamically from IMenuRegistry -->
            </MenuBar>

            <!-- Search Box -->
            <AutoSuggestBox x:Name="SearchBox"
                           Grid.Column="2"
                           QueryIcon="Find"
                           Width="300"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="0,4"/>
        </Grid>

        <!-- Main Content -->
        <NavigationView x:Name="NavView"
                       Grid.Row="1"
                       IsBackButtonVisible="Auto"
                       IsSettingsVisible="True"
                       PaneDisplayMode="Left"
                       IsPaneOpen="True"
                       OpenPaneLength="240"
                       ItemInvoked="NavView_ItemInvoked"
                       BackRequested="NavView_BackRequested"
                       Background="{ThemeResource NavigationViewDefaultPaneBackground}">

            <NavigationView.MenuItems>
                <NavigationViewItem x:Name="NavHome" Icon="Home" Tag="HomePage"/>
                <NavigationViewItemSeparator/>
                <NavigationViewItemHeader x:Name="NavHeaderBusiness"/>
                <NavigationViewItem x:Name="NavCustomers" Icon="People" Tag="CustomerListPage"/>
                <NavigationViewItem x:Name="NavProducts" Icon="Shop" Tag="ProductListPage"/>
                <NavigationViewItem x:Name="NavOrders" Icon="Document" Tag="OrderListPage"/>
                <NavigationViewItemSeparator/>
                <NavigationViewItemHeader x:Name="NavHeaderReports"/>
                <NavigationViewItem x:Name="NavReports" Icon="Library" Tag="SalesReportPage"/>
            </NavigationView.MenuItems>

            <NavigationView.FooterMenuItems>
                <NavigationViewItem x:Name="NavPlugins" Tag="PluginManagerPage">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xEA86;"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem x:Name="NavSync" Icon="Sync" Tag="SyncPage">
                    <NavigationViewItem.InfoBadge>
                        <InfoBadge x:Name="SyncBadge" Value="0"/>
                    </NavigationViewItem.InfoBadge>
                </NavigationViewItem>
            </NavigationView.FooterMenuItems>

            <!-- Tab View for MDI -->
            <Grid>
                <TabView x:Name="TabViewMain"
                        IsAddTabButtonVisible="False"
                        TabCloseRequested="TabView_TabCloseRequested"
                        CanReorderTabs="True"
                        CanDragTabs="True"
                        TabWidthMode="Equal"
                        VerticalAlignment="Stretch"
                        HorizontalAlignment="Stretch">
                    <TabView.Resources>
                        <x:Double x:Key="TabViewItemHeaderMinWidth">100</x:Double>
                        <x:Double x:Key="TabViewItemMaxWidth">180</x:Double>
                    </TabView.Resources>
                    <TabView.TabStripHeader>
                        <Grid Padding="4,0">
                            <DropDownButton x:Name="AddTabButton" VerticalAlignment="Center" Padding="8,4">
                                <FontIcon Glyph="&#xE710;" FontSize="12"/>
                                <DropDownButton.Flyout>
                                    <MenuFlyout x:Name="QuickActionsFlyout" Placement="BottomEdgeAlignedLeft">
                                        <!-- Quick actions are populated dynamically from IMenuRegistry -->
                                    </MenuFlyout>
                                </DropDownButton.Flyout>
                            </DropDownButton>
                        </Grid>
                    </TabView.TabStripHeader>
                </TabView>
            </Grid>

        </NavigationView>

        <!-- Status Bar -->
        <Grid x:Name="StatusBar" Grid.Row="2" Height="24" Background="{ThemeResource NavigationViewDefaultPaneBackground}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock x:Name="StatusMessage"
                      VerticalAlignment="Center"
                      Margin="12,0"
                      Style="{StaticResource CaptionTextBlockStyle}"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="8,0">
                <FontIcon Glyph="&#xE701;" FontSize="12" x:Name="NetworkIcon"/>
                <TextBlock x:Name="NetworkStatus" Style="{StaticResource CaptionTextBlockStyle}" VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="8,0">
                <FontIcon Glyph="&#xE895;" FontSize="12"/>
                <TextBlock x:Name="SyncStatus" Style="{StaticResource CaptionTextBlockStyle}" VerticalAlignment="Center"/>
            </StackPanel>

            <TextBlock Grid.Column="3"
                      x:Name="CurrentTime"
                      Style="{StaticResource CaptionTextBlockStyle}"
                      VerticalAlignment="Center"
                      Margin="12,0"/>
        </Grid>
    </Grid>
</Window>
